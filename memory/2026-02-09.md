# 2026-02-09 — PPC + Rank Radar APIs Connected

## Amazon Ads API (PPC) — Completed

Fixed v2 → v3 API migration (v2 endpoints were returning 404s).

**Updated file:** `~/amazon-data/collectors/ads_api_client.py`
- Now uses v3 Reporting API endpoints
- Endpoint: `/reporting/reports`
- Headers: `application/vnd.createasyncreportrequest.v3+json`
- Date format: `YYYY-MM-DD` (not YYYYMMDD like v2)

**First collection (Feb 8 data):**
| Marketplace | Campaigns | Keywords | Search Terms |
|-------------|-----------|----------|--------------|
| US | 73 | 501 | 75 |
| CA | 28 | 205 | 18 |

**SQLite tables:** `ppc_campaigns`, `ppc_keywords`, `ppc_search_terms`

**Scheduled:** Daily at 6:30 AM EST

---

## DataDive Rank Radar API — Connected

**API Key:** Stored in `~/amazon-data/.env` as `DATADIVE_API_KEY`

**API Usage:**
- List radars: `GET /v1/niches/rank-radars`
- Get ranks: `GET /v1/niches/rank-radars/{id}?startDate=YYYY-MM-DD&endDate=YYYY-MM-DD`
- Auth header: `X-API-KEY`

**Created:** `~/amazon-data/collectors/daily_ranks.py`
- Fetches all 15 Rank Radars
- Stores keyword rankings in `keyword_ranking` table
- State tracking in `~/amazon-data/rank_state.json`
- Archives raw JSON to `reports/raw/YYYY-MM/`

**First collection:**
- 15 Rank Radars (US + CA)
- ~5,300 keyword rankings stored

**Scheduled:**
- Daily at 7:00 AM EST (initial)
- Retries at 10AM, 1PM, 4PM, 7PM, 10PM if incomplete

---

## Complete Daily Schedule

| Time | Job | Data |
|------|-----|------|
| 6:00 AM | Daily Amazon | Inventory + Orders (US/CA) |
| 6:30 AM | Daily PPC | Campaigns, Keywords, Search Terms |
| 7:00 AM | Daily Ranks | Keyword rankings (15 radars) |
| 10AM-10PM | Rank Retry | Every 3h if morning incomplete |
| Mon 6AM | Weekly SQP | Brand Analytics per ASIN |
| Mon-Wed | SQP Retry | Every 3h if SQP unavailable |

---

## Database Schema Update

Recreated `keyword_ranking` table with correct schema:
```sql
CREATE TABLE keyword_ranking (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    asin TEXT NOT NULL,
    marketplace TEXT NOT NULL,
    rank_radar_id TEXT NOT NULL,
    report_date DATE NOT NULL,
    keyword TEXT NOT NULL,
    search_volume INTEGER,
    relevancy TEXT,
    organic_rank INTEGER,
    impression_rank INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(asin, marketplace, report_date, keyword)
)
```

---

## All APIs Now Connected

1. ✅ SP-API (Inventory, Orders, Restock)
2. ✅ Brand Analytics (SQP per ASIN)
3. ✅ Amazon Ads API (PPC data)
4. ✅ DataDive Rank Radar (Keyword rankings)

Data warehouse fully automated!
